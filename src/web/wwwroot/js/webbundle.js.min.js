"use strict";var StopByStop;!function(t){!function(t){t[t.restaurants=1]="restaurants",t[t.gasstations=2]="gasstations",t[t.hotels=4]="hotels",t[t.sights=8]="sights",t[t.all=15]="all"}(t.PoiType||(t.PoiType={}));!function(t){t[t.home=0]="home",t[t.route=1]="route",t[t.exit=2]="exit",t[t.poi=3]="poi",t[t.about=4]="about"}(t.SBSPage||(t.SBSPage={}));!function(t){t[t.Light=1]="Light",t[t.Dark=2]="Dark",t[t.Map=4]="Map"}(t.PoiIconFormat||(t.PoiIconFormat={}))}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e;!function(t){t[t.Add5MinToStop=0]="Add5MinToStop",t[t.AddStopToRoute=1]="AddStopToRoute",t[t.CityDropdownClick=2]="CityDropdownClick",t[t.FilterButtonClick=3]="FilterButtonClick",t[t.FilterButtonInlineExitPageClick=4]="FilterButtonInlineExitPageClick",t[t.FilterMaxDistanceFromJunctionChanged=5]="FilterMaxDistanceFromJunctionChanged",t[t.FilterShowGasStationsChanged=6]="FilterShowGasStationsChanged",t[t.FilterShowRestaurantsChanged=7]="FilterShowRestaurantsChanged",t[t.LocationIN=8]="LocationIN",t[t.LocationOUT=9]="LocationOUT",t[t.LocationOUTPopupDisplayed=10]="LocationOUTPopupDisplayed",t[t.NonBounce=11]="NonBounce",t[t.POIGroupPageScroll=12]="POIGroupPageScroll",t[t.POIGroupSwitchList=13]="POIGroupSwitchList",t[t.POIGroupSwitchMap=14]="POIGroupSwitchMap",t[t.POIPageAddToRouteClick=15]="POIPageAddToRouteClick",t[t.POIPageNavigateClick=16]="POIPageNavigateClick",t[t.POIPageNavigateBeforeDirect=17]="POIPageNavigateBeforeDirect",t[t.Remove5MinFromStop=18]="Remove5MinFromStop",t[t.RemoveStopFromRoute=19]="RemoveStopFromRoute",t[t.RoutePageScroll=20]="RoutePageScroll",t[t.RoutePlanNavigateClick=21]="RoutePlanNavigateClick",t[t.RoutePlanNavigateBeforeDirect=22]="RoutePlanNavigateBeforeDirect",t[t.ShowStopSettingsPopup=23]="ShowStopSettingsPopup",t[t.SideBarThumbTouch=24]="SideBarThumbTouch",t[t.SocialButtonClick=25]="SocialButtonClick",t[t.StopPopupNavigateClick=26]="StopPopupNavigateClick",t[t.StopPopupNavigateBeforeDirect=27]="StopPopupNavigateBeforeDirect",t[t.TelLinkClick=28]="TelLinkClick",t[t.ViewTripButtonClick=29]="ViewTripButtonClick",t[t.YelpLinkClick=30]="YelpLinkClick"}(e=t.TelemetryEvent||(t.TelemetryEvent={}));var i;!function(t){t[t.FilterVisibility=0]="FilterVisibility",t[t.LoadStopsFromCache=1]="LoadStopsFromCache",t[t.PageName=2]="PageName",t[t.StopCount=3]="StopCount",t[t.NavigationUrl=4]="NavigationUrl"}(i=t.TelemetryProperty||(t.TelemetryProperty={}));var o;o=t.TelemetryMeasurement||(t.TelemetryMeasurement={});var n=function(){function n(){}return n.trackPageView=function(t,e,i,o,r,a){void 0===o&&(o=null),void 0===r&&(r=null),void 0===a&&(a=!1);try{var s=n.getAIProperties(o),p=n.getAIMeasurements(r);n._appInsights.trackPageView(t,e,s,p,i),a&&n._appInsights.flush()}catch(t){n.logFatal(t)}},n.trackEvent=function(t,i,o,r){void 0===i&&(i=null),void 0===o&&(o=null),void 0===r&&(r=!1);try{var a=n.getAIProperties(i),s=n.getAIMeasurements(o);n._appInsights.trackEvent(e[t],a,s),r&&n._appInsights.flush()}catch(t){n.logFatal(t)}},n.trackError=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=!1);try{var r=n.getAIProperties(e),a=n.getAIMeasurements(i);n.logFatal(t),n._appInsights.trackException(t,"",r,a),o&&n._appInsights.flush()}catch(t){n.logFatal(t)}},n.logToConsole=function(t){window.console&&window.console.log(t)},n.getAIProperties=function(e){var o={};return o[i[i.PageName]]=t.AppState.current.pageInfo.telemetryPageName,e&&$.each(e,function(t,e){o[i[e.k]]=e.v}),o},n.getAIMeasurements=function(t){var e={};return t&&$.each(t,function(t,i){e[o[i.k]]=i.v}),e},n.logFatal=function(t){n.logErrorToConsole("ERROR-TO-TELEMETRY:"+t)},n.logErrorToConsole=function(t){window.console&&window.console.error&&(t.message?window.console.error(t.message):window.console.error(t))},n._appInsights=window.appInsights,n}();t.Telemetry=n}(StopByStop||(StopByStop={}));var StopByStop;!function(t){t.PAGENAME_HOME="sbs-homePG",t.PAGENAME_Route="route-page",t.PAGENAME_POIGroup="poigroup-page",t.PAGENAME_Exit="exit-page",t.PAGENAME_About="about-page",t.N_LAT_BOUNDARY=50,t.S_LAT_BOUNDARY=25,t.W_LON_BOUNDARY=-125,t.E_LON_BOUNDARY=-66,t.ROUTE_PLAN_STORAGE_KEY="sbsroutes";var e=function(){function e(){}return e.getNonHighwayDrivingTimeToPlaceInSeconds=function(t){return t/20*3600},e.updateNavigationLocation=function(e,i){e||(e="#home"),e=e.toLowerCase();var o=e.indexOf("#"),n=null;if(o<0&&(e="#home",o=0),o>=0){var r=e.indexOf("&",o)-1;r<0?r=e.length-1:n=e.substr(r+1);var a=e.substr(o+1,r-o);if(void 0!==t.SBSPage[a]&&(i.page=t.SBSPage[a]),n)for(var s=n.split("&"),p=0;p<s.length;p++){var u=s[p].split("=");if(2===u.length){var c=u[0],l=u[1];switch(c){case"routeid":i.routeId=l,i.poiType=void 0;break;case"exitid":i.exitId=l;break;case"poiid":i.poiId=l;case"poitype":i.poiType=t.PoiType.all,l&&(i.poiType=t.PoiType[l]||i.poiType)}}}}},e.getHashFromNavigationLocation=function(e){var i="#";return t.SBSPage[e.page]?i+=t.SBSPage[e.page]:i+="home",e.routeId&&(i+="&routeid="+e.routeId),!e.exitId||e.page!==t.SBSPage.exit&&e.page!==t.SBSPage.poi||(i+="&exitid="+e.exitId),e.poiId&&e.page===t.SBSPage.poi&&(i+="&poiid="+e.poiId),e.poiType&&e.page===t.SBSPage.exit&&t.PoiType[e.poiType]&&(i+="&poitype="+t.PoiType[e.poiType]),i.toLowerCase()},e.getMileString=function(t){return t<.1?"<0.1mi":t.toString()+"mi"},e.getHours=function(t){return Math.floor(t%31536e3%86400/3600)},e.getMinutes=function(t){return Math.floor(t%31536e3%86400%3600/60)},e.getTimeString=function(t,i){return void 0===i&&(i=0),t=new Date(t.getTime()+i),e.formatTime(t)},e.formatTime=function(t){var e=t.getHours(),i=t.getMinutes(),o=i.toString(),n=e>=12?"pm":"am";return e%=12,0===e&&(e=12),i<10&&(o="0"+o),e.toString()+":"+o+" "+n},e.hasAnyOwnProperties=function(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1},e.runOnce=function(t){var e,i=!1;return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];return i||(i=!0,e=t.apply(this,arguments)),e}},e.spaPageNavigate=function(e,i){void 0===i&&(i=!0);var o="#home";switch(e.page){case t.SBSPage.about:o="#about";break;case t.SBSPage.exit:o="#exit";break;case t.SBSPage.poi:o="#poi";break;case t.SBSPage.route:o="#route"}var n=o;e.routeId&&(n+="&routeid="+e.routeId),e.exitId&&(n+="&exitid="+e.exitId),e.poiType&&(n+="&poitype="+t.PoiType[e.poiType].toLowerCase()),e.poiId&&(n+="&poiId="+e.poiId);var r=t.AppState.current.navigationLocation&&t.AppState.current.navigationLocation.page>e.page;t.AppState.current.knownHashChangeInProgress=!0,$.mobile.pageContainer.pagecontainer("change",o,{dataUrl:n,changeHash:i,transition:"slide",reverse:r})},e.getShareUrl=function(e,i){var o=e;switch("/"!==o.substr(o.length-1)&&(o+="/"),i.page){case t.SBSPage.route:case t.SBSPage.exit:o+="route/"+i.routeId,i.page===t.SBSPage.exit&&(o+="/exit/osm-"+i.exitId,i.poiType&&(o+="/"+t.PoiType[i.poiType]));break;case t.SBSPage.poi:o+="poi/"+i.poiPath}return o},e.getRouteTitleFromRouteId=function(t){var i="";if(t&&t.indexOf("-to-")>1){var o=t.split("-to-"),n=o[0],r=o[1];n.length>1&&r.length>1&&(n=$.isNumeric(n[0])?"your location":e.getPlaceNameFromPlaceId(n)),r=e.getPlaceNameFromPlaceId(r),i=n&&r?"from "+n+" to "+r:""}return i},e.isHistoryAPISupported=function(){return!(!window.history||!history.pushState)},e.windowOpen=function(e){"_blank"===t.AppState.current.windowOpenTarget?window.location.assign(e):window.open(e,t.AppState.current.windowOpenTarget,"location=yes")},e.getPoiIconUrl=function(e,i,o){var n=t.PoiType[e].toLowerCase();return o+"poi/"+n+"/"+n+"_"+i.toString()+".png"},e.getNavigationUrlFromCurrentLocation=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=$.Deferred();return e&&e.length>0?navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){for(var i=t.coords.latitude,n=t.coords.longitude,r="",a=0;a<e.length-1;a++)a>0&&(r+="+to:"),r+=e[a].a+","+e[a].o;""!==r&&(r+="+to:");var s=e[e.length-1];r+=s.a+","+s.o;var p="https://maps.google.com/maps?saddr="+i+","+n+"&daddr="+r;o.resolve(p)},function(e){var i=e.message;t.Telemetry.trackError(new Error("getCurrentPositionError: "+i)),console.error("Please allow StopByStop.com to share your location."),o.reject(i)}):o.reject(),o.promise()},e.getPlaceNameFromPlaceId=function(t){var e="",i=t.indexOf("-united-states");if(i>0){t=t.substr(0,i);var o=t.substr(t.length-2,2).toUpperCase();t=t.substr(0,t.length-3),t=t.replace(/-/g," "),e=t.replace(/([^ \t]+)/g,function(t,e){return e[0].toUpperCase()+e.substr(1)})+", "+o}return e},e.observeDOM=function(){var t=window.MutationObserver||window.WebKitMutationObserver,e=window.addEventListener;return function(i,o){if(t){new t(function(t,e){(t[0].addedNodes.length||t[0].removedNodes.length)&&o()}).observe(i,{childList:!0,subtree:!0})}else e&&(i.addEventListener("DOMNodeInserted",o,!1),i.addEventListener("DOMNodeRemoved",o,!1))}}(),e}();t.Utils=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function t(){}return t.current={basePortalUrl:null,baseDataUrl:null,baseImageUrl:null,windowOpenTarget:"_system",metadata:null},t}();t.AppState=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function t(t,e){"string"!=typeof t?t="/":/\/$/.test(t)||(t+="/"),this.BaseImageUrl=e,this.BaseUrl=t,this.PlacesDataUrlV2=t+"placev2/",this.RouteDataUrlV2=t+"routedatav2/",this.PoiDataUrlV2=t+"poiv2/",this.PlacesNearbyDataUrlV2=t+"placesnearbyv2/",this.CityImagesUrl=e+"city_images/"}return t}();t.InitUrls=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(){}return e.addImagesDynamically=function(i,o){var i=$("#Images").data("prevPlace"),n=$("#from").data("place");if(null===n)return!0;if(i&&i.n===n.n)return!0;$("#Images").data("prevPlace",n),$("#Images").empty();var r="";if(n.n===o){var a=n.i.replace(",","/");r=t.AppState.current.urls.PlacesNearbyDataUrlV2+a}else r=t.AppState.current.urls.PlacesNearbyDataUrlV2+n.l.a+"/"+n.l.o;$.ajax({url:r,dataType:"json",method:"GET",success:function(i){var o=($("#Images"),[]),n=0,r=i.length;for(r>10&&window.screen.width>480&&(r=10),r>6&&window.screen.width<480&&(r=6),n;n<r;n+=1){o.push(e.createDiv(n,i[n])),$(o[n]).data("place",i[n]),$("#Images").append(o[n]),$(o[n]).on("click",function(){$("#to").val($(this).data("place").n);var t={n:$(this).data("place").n,i:$(this).data("place").i};$("#to").data("place",t),$("#view_trip").removeClass("ui-disabled")});var a=t.AppState.current.urls.CityImagesUrl+i[n].i+".jpg";$("#appendedImagediv"+n).css("background-image","url("+a+")")}e.moveImageInBackground()}})},e.moveImageInBackground=function(){e.yIncrement=e.yIncrement+1;var t=0,i=null;for(t=0;t<10;t++){var o=$("#appendedImagediv"+t);o&&$(o).css("background-position","0px "+e.yIncrement+"px")}i=requestAnimationFrame(e.moveImageInBackground),e.yIncrement>=0&&(cancelAnimationFrame(i),e.yIncrement=-100)},e.createDiv=function(t,e){var i=document.createElement("div");i.id="appendedImagediv"+t,i.className="imageholder";var o=document.createElement("div");return o.id="appendedInnerdiv"+t,o.className="childdiv",o.innerHTML=e.sn,i.appendChild(o),o.onclick=function(){$("#to").val($(this).parent("div").data("place").n);var t={n:$(this).parent("div").data("place").n,i:$(this).parent("div").data("place").i};$("#to").data("place",t),$("#view_trip").removeClass("ui-disabled")},i},e.wireup=function(){var i=null,o=null;!function(){navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(i){var n=i.coords.latitude,r=i.coords.longitude;n>t.S_LAT_BOUNDARY&&n<t.N_LAT_BOUNDARY&&r>t.W_LON_BOUNDARY&&r<t.E_LON_BOUNDARY?(o={n:"Current location",i:n.toFixed(5)+","+r.toFixed(5)},$("#from").val("Current location"),$("#from").data({place:o}),$("#from").data("place")&&e.addImagesDynamically(null,"Current location"),t.Telemetry.trackEvent(t.TelemetryEvent.LocationIN)):t.Telemetry.trackEvent(t.TelemetryEvent.LocationOUT)},function(e){var i="UNAVAILABLE";switch(e.code){case e.PERMISSION_DENIED:i="PERMISSION_DENIED";break;case e.POSITION_UNAVAILABLE:i="POSITION_UNAVAILABLE";break;case e.TIMEOUT:i="TIMEOUT"}t.Telemetry.trackError(new Error("getCurrentPositionErrorHomePage-"+i))},{maximumAge:6e4,timeout:5e3,enableHighAccuracy:!0})}(),$(".input-wrapper input").on("keyup",function(e,n){var r=$(this).closest(".input-wrapper"),a=this,s=r.find("ul"),p=$(this),u=p.val();u&&(r.append("<div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div>"),$.ajax({url:t.AppState.current.urls.PlacesDataUrlV2+u,dataType:"json",method:"GET",success:function(t){i=t,r.find(".ui-loader").remove(),s.empty();var e="from"===$(a).attr("id")?$("#to"):$("#from"),n=null;if(e.data("place")&&(n=e.data("place").i),"from"===$(a).attr("id")&&o){var p=$('<li data-icon="false"><a href="#">Current location</a></li>');p.data("place",o),s.append(p)}for(var u=0;u<t.length;u++)if(t[u].i!==n){var p=$('<li data-icon="false"><a href="#">'+t[u].n+"</a></li>");p.data("place",t[u]),s.append(p)}s.listview("refresh"),s.trigger("updatelayout")}}))}),$(".autocomplete").on("click","li",function(i){var o=$(this).closest("div").find("input"),n=$(this).data("place");n&&(o.val(n.n).data("place",n),$(this).closest("ul").empty(),$("#from").data("place")&&$("#to").data("place")&&$("#view_trip").removeClass("ui-disabled"),e.addImagesDynamically(null,"Current location")),t.Telemetry.trackEvent(t.TelemetryEvent.CityDropdownClick)}),$(".input-wrapper input").on("focus",function(t){var e=$(this);window.setTimeout(function(){e.select()},100);var i=$(this).closest(".input-wrapper");i.find("ul").show(),i.find(".input-tip").hide()}),$(".view-trip").on("click",function(e){t.Telemetry.trackEvent(t.TelemetryEvent.ViewTripButtonClick,null,null,!0);var i=$("#from"),o=$("#to"),n=i.data("place"),r=o.data("place");t.Utils.spaPageNavigate({page:t.SBSPage.route,routeId:n.i+"-to-"+r.i})}),$("#from").data("place")&&$("#to").data("place")&&$("#view_trip").removeClass("ui-disabled")},e.yIncrement=-100,e}();t.InitHome=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,o,n){var r=this;this._metadata=o,this.rootCategory=o.rpc[t.PoiType[e]],this.categoryName=this.rootCategory.n,this.typeName=t.PoiType[e].toLowerCase(),this.isOn=ko.observable(!0),this.type=e,this.categoryFilter=new i({n:"Categories",id:"categories"},this),this.propertyEnablementLookup={},this.propertyList=[],this._pois=[],this.filteredCount=ko.observable(0),this.filteredCountWithFeatures=ko.observable(0),this._maxDistanceFromJunction=3,this._filter=n,this.isOn.subscribe(function(t){return r.updatePoisVisibility()})}return e.prototype.updatePoisVisibility=function(t,e){var i=this;void 0===e&&(e=!0),this._maxDistanceFromJunction=t||this._maxDistanceFromJunction;var o=0;$.each(this._pois,function(t,e){var n=i.isOn();n&&(e.dfj>i._maxDistanceFromJunction?n=!1:i.rootCategory.scf&&!i.categoryFilter.isOn(e.p.c)?n=!1:$.each(i.propertyList,function(t,i){i.isOn(e.p.pp[i.id])||(n=!1)})),e.v=n,n&&o++}),this.filteredCountWithFeatures(o),e&&this._filter.onFilterUpdated()},e.prototype.initWithPoi=function(t){var e=this;this._pois.push(t);var o=t.p;if(this.rootCategory.scf)for(var n=o.c,r=0;r<n.length;r++){var a=this._metadata.c[n[r]],s=a.id===this.rootCategory.c?"All other":a.n,p={id:a.id,n:s},u=this.categoryFilter.addValue(p);u.tempCount++}for(var c in o.pp)if(this._metadata.ppm[c]){if(!this.propertyEnablementLookup[c]){var l=new i(this._metadata.ppm[c],this);this.propertyEnablementLookup[c]=l,this.propertyList.push(l)}$.each(o.pp[c],function(t,i){e.propertyEnablementLookup[c].addValue(e._metadata.ppm[c].v[i]).tempCount++})}},e.prototype.sortValuesByOccurrence=function(){this.categoryFilter.sortByOccurrence(),$.each(this.propertyList,function(t,e){e.sortByOccurrence()})},e.prototype.getCategoriesEnablement=function(){return this.categoryFilter.getValuesEnablement()},e.prototype.setCategoriesEnablement=function(t){this.categoryFilter.setValuesEnablement(t)},e.prototype.getPropertiesEnablement=function(){var t={};return $.each(this.propertyList,function(e,i){t[i.id]=i.getValuesEnablement()}),t},e.prototype.setPropertiesEnablement=function(t){$.each(this.propertyList,function(e,i){i.setValuesEnablement(t[i.id])})},e.prototype.resetTempCount=function(){this._tempCount=0,this.categoryFilter.resetTempCount(),$.each(this.propertyList,function(t,e){e.resetTempCount()})},e.prototype.applyTempCount=function(){this.filteredCount(this._tempCount),this.categoryFilter.applyTempCount(),$.each(this.propertyList,function(t,e){e.applyTempCount()})},e.prototype.incrementTempCountForPoi=function(t){this._tempCount++,this.categoryFilter.incrementTempCount(t.c);for(var e in t.pp)if(this.propertyEnablementLookup[e]){var i=t.pp[e];this.propertyEnablementLookup[e].incrementTempCount(i)}},e}();t.PoiTypeFilterViewModel=e;var i=function(){function t(t,e){this.isCollapsed=ko.observable(!0),this.valueEnablementLookup={},this.valueList=[],this.name=t.n,this.id=t.id,this.filter=e}return t.prototype.addValue=function(t){if(!this.valueEnablementLookup[t.id]){var e=new o(t.id,t.n,this,this.filter);this.valueEnablementLookup[t.id]=e,this.valueList.push(e)}return this.valueEnablementLookup[t.id]},t.prototype.sortByOccurrence=function(){this.valueList.sort(function(t,e){return e.tempCount-t.tempCount})},t.prototype.expand=function(){this.isCollapsed(!1)},t.prototype.collapse=function(){this.isCollapsed(!0)},t.prototype.isOn=function(t){var e=this,i=!1;return $.each(t,function(t,o){e.valueEnablementLookup[o].isOn()&&(i=!0)}),i},t.prototype.getValuesEnablement=function(){var t={};return $.each(this.valueList,function(e,i){t[i.id]=i.isOn()}),t},t.prototype.setValuesEnablement=function(t){$.each(this.valueList,function(e,i){i.isOn(t[i.id])})},t.prototype.selectAll=function(){$.each(this.valueList,function(t,e){e.processingBulkUpdate=!0;try{e.isOn(!0)}finally{e.processingBulkUpdate=!1}}),this.filter.updatePoisVisibility()},t.prototype.unselectAll=function(){$.each(this.valueList,function(t,e){e.processingBulkUpdate=!0;try{e.isOn(!1)}finally{e.processingBulkUpdate=!1}}),this.filter.updatePoisVisibility()},t.prototype.resetTempCount=function(){$.each(this.valueList,function(t,e){e.tempCount=0})},t.prototype.applyTempCount=function(){$.each(this.valueList,function(t,e){e.count(e.tempCount)})},t.prototype.incrementTempCount=function(t){$.each(this.valueList,function(e,i){t.indexOf(i.id)>-1&&i.tempCount++})},t}();t.MultiValueFilterViewModel=i;var o=function(){function t(t,e,i,o){var n=this;this.parentCategory=i,this.id=t,this.isOn=ko.observable(!0),this.count=ko.observable(0),this.tempCount=0,this.name=e,this._filter=o,this.processingBulkUpdate=!1,this.isOn.subscribe(function(t){n.processingBulkUpdate||n._filter.updatePoisVisibility()})}return t}();t.ValueFilterViewModel=o}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(t,e,i,o){void 0===o&&(o=!0);var n=this;this.routeId=t,this.routeJunctions=e,this.preserveShowAllSettings=o,this.typeFiltersList=[],this.typeFiltersLookup={},this.maxDistanceFromJunction=ko.observable("3"),this.maxDistanceFromJunctionIs1=ko.observable(!1),this.maxDistanceFromJunctionIs2=ko.observable(!1),this.maxDistanceFromJunctionIs3=ko.observable(!0),this.maxDistanceFromJunctionIs4=ko.observable(!1),this.maxDistanceFromJunctionIs5=ko.observable(!1);for(var r=[[this.maxDistanceFromJunctionIs1,"1"],[this.maxDistanceFromJunctionIs2,"2"],[this.maxDistanceFromJunctionIs3,"3"],[this.maxDistanceFromJunctionIs4,"4"],[this.maxDistanceFromJunctionIs5,"5"]],a=0;a<r.length;a++){var s=r[a];s[0].subscribe(function(t){var e=arguments[0];if(arguments[1]){this.maxDistanceFromJunction(e[1]);for(var i=0;i<r.length;i++)r[i][1]!==e[1]&&r[i][0](!1)}}.bind(this,s))}this.populate(i),$.each(this.typeFiltersList,function(t,e){e.updatePoisVisibility(parseInt(n.maxDistanceFromJunction()),!1)}),this.updateCounts(),this.maxDistanceFromJunction.subscribe(function(t){$.each(n.typeFiltersList,function(e,i){i.updatePoisVisibility(parseInt(t),!1)}),n.updateCounts(),n.onFilterUpdated()})}return e.prototype.copyEnablement=function(t){for(var e=0;e<t.typeFiltersList.length;e++){var i=t.typeFiltersList[e].getCategoriesEnablement(),o=t.typeFiltersList[e].getPropertiesEnablement();this.typeFiltersLookup[t.typeFiltersList[e].type]&&(this.typeFiltersLookup[t.typeFiltersList[e].type].setCategoriesEnablement(i),this.typeFiltersLookup[t.typeFiltersList[e].type].setPropertiesEnablement(o))}},e.prototype.populate=function(e){for(var i=0;i<this.routeJunctions.length;i++)for(var o=this.routeJunctions[i],n=0;n<o.j.p.length;n++){var r=o.j.p[n],a=r.p;if(!this.typeFiltersLookup[a.t]){var s=new t.PoiTypeFilterViewModel(a.t,e,this);this.typeFiltersList.push(s),this.typeFiltersLookup[a.t]=s}this.typeFiltersLookup[a.t].initWithPoi(r)}$.each(this.typeFiltersList,function(t,e){e.sortValuesByOccurrence()})},e.prototype.updateCounts=function(){var t=parseInt(this.maxDistanceFromJunction());$.each(this.typeFiltersList,function(t,e){e.resetTempCount()});for(var e=0;e<this.routeJunctions.length;e++)for(var i=this.routeJunctions[e],o=0;o<i.j.p.length;o++){var n=i.j.p[o];if(n.dfj<=t){var r=n.p;this.typeFiltersLookup[r.t].incrementTempCountForPoi(r)}}$.each(this.typeFiltersList,function(t,e){e.applyTempCount()})},e}();t.FilterViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function t(t){this.a=this.lat=t.a,this.o=this.lon=t.o,this.placeDescription=t.pd||""}return t.getGridLocations=function(e){var i=new t({a:t.roundToNLat(e.a),o:t.roundToWLon(e.o)});return[i,new t({a:i.lat+t.GRAIN,o:i.lon-t.GRAIN}),new t({a:i.lat+t.GRAIN,o:i.lon}),new t({a:i.lat+t.GRAIN,o:i.lon+t.GRAIN}),new t({a:i.lat,o:i.lon+t.GRAIN}),new t({a:i.lat-t.GRAIN,o:i.lon+t.GRAIN}),new t({a:i.lat-t.GRAIN,o:i.lon}),new t({a:i.lat-t.GRAIN,o:i.lon-t.GRAIN}),new t({a:i.lat,o:i.lon-t.GRAIN})]},t.roundToNLat=function(e){var i=t.round1DecimalDigit(e);return i<e&&(i+=.1),i},t.roundToWLon=function(e){var i=t.round1DecimalDigit(e);return i>e&&(i-=.1),i},t.round1DecimalDigit=function(t){return Math.round(10*t)/10},t.GRAIN=.1,t}();t.LocationViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function t(t){this._obj=t,this.name=ko.observable(this._obj.n),this.icon=ko.observable(this._obj.i),this.reviewCount=ko.observable(this._obj.rc),this.reviewPageUrl=ko.observable(this._obj.u),this.ratingImageUrl=ko.observable(this._obj.riu),this.rating=ko.observable(this._obj.r)}return t}();t.ReviewGroupViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function t(t,e,i,o){this.name=i,this.values=o,this.id=t,this.poiTypeString=e}return t}();t.PoiSimplePropertyViewModel=e;var i=function(){function t(t,e,i){this.id=e.id,this.poiTypeString=t,this.metadata=e,this.name=e.n,this.values=i.map(function(t,i,o){return e.v[t].n})}return t}();t.PoiMetadataPropertyViewModel=i;var o=function(){function e(e,o,n){void 0===n&&(n=null),this._poiOnJunction=n,this._poiOnJunction.poi=this,this._obj=e,this._app=o,this.id=this._obj.id,this.categories=this._obj.c.map(function(e,i,o){return t.AppState.current.metadata.c[e]}),this.poiType=this._obj.t,this.name=this._obj.n,this.description=ko.observable(this._obj.d),this.location=new t.LocationViewModel(this._obj.l),this.visible=ko.observable(!0),this.telPhoneString=this._obj.p,this.isYInfoLoading=ko.observable(!0),this.isYInfoVisible=ko.observable(!0),this.yUrl=ko.observable("#"),this.yStarClass=ko.observable("stars_0"),this.yReviewCountString=ko.observable(""),this.urlName=this._obj.un,this.poiTypeString=t.PoiType[this.poiType].toLowerCase(),this._poiOnJunction&&(this.stop=this._app.routePlan.getOrCreateStop(this._poiOnJunction)),this.properties=[];var r=t.AppState.current.metadata;for(var a in this._obj.pp)if(this._obj.pp[a]){var s=r.ppm[a];if(s){var p=this._obj.pp[a];this.properties.push(new i(this.poiTypeString,s,p))}}}return e.prototype.addToRouteOptionsClick=function(){this.stop&&(t.Telemetry.trackEvent(t.TelemetryEvent.POIPageAddToRouteClick,null,null,!1),this._app.routePlan.showStopSettings(this.stop))},e.prototype.navigateNowClick=function(){if(this.stop){t.Telemetry.trackEvent(t.TelemetryEvent.POIPageNavigateClick,null,null,!1);t.Utils.getNavigationUrlFromCurrentLocation(this.stop.poiOnJunction.poi.location).done(function(e){t.Telemetry.trackEvent(t.TelemetryEvent.POIPageNavigateBeforeDirect,[{k:t.TelemetryProperty.NavigationUrl,v:e}],null,!0),t.Utils.windowOpen(e)})}},e.prototype.updateYInfo=function(t){t?(this.yUrl(t.u),this.yStarClass(e.getYStarClass(t.r)),this.yReviewCountString(e.getReviewsString(t.rc)),this.isYInfoLoading(!1),this._reviewDataItem=t):this._reviewDataItem||this.isYInfoVisible(!1)},e.getReviewsString=function(t){return 0===t?"no reviews":1===t?"1 review":t.toString()+" reviews"},e.getYStarClass=function(t){var e=null;switch(t.toString()){case"5":e="stars_5";break;case"4.5":e="stars_4_half";break;case"4":e="stars_4";break;case"3.5":e="stars_3_half";break;case"3":e="stars_3";break;case"2.5":e="stars_2_half";break;case"2":e="stars_2";break;case"1.5":e="stars_1_half";break;case"1":e="stars_1";break;case"0":e="stars_0"}return e},e}();t.PoiViewModel=o}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i,o){this.obj=e,this._app=o,this.dfe=this.obj.dfj,this.dtefrs=i.dfrs,this.exitId=i.osmid.toString(),this.poi=new t.PoiViewModel(this.obj.p,o,this),this.distanceFromJunctionText=t.Utils.getMileString(this.dfe)+" from exit",this.distanceFromJunctionTextFull=t.Utils.getMileString(this.dfe)+" from "+i.name,this._navLocation={page:t.SBSPage.poi,routeId:t.AppState.current.navigationLocation.routeId,exitId:this.exitId,poiId:this.poi.id,poiPath:this.poi.id+"-"+this.poi.urlName}}return e.prototype.navigateToPoiPageClick=function(){this._app.selectedPoi(this.poi),t.Utils.spaPageNavigate(this._navLocation)},e}();t.PoiOnJunctionViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e){var i=this;this.poiOnJunction=e,this.stopDurationFastUpdate=ko.observable(15),this.stopDuration=ko.observable(15),this.stopDuration.extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),this.exitEta=ko.observable(new Date),this.etaToStopString=ko.computed(function(){var e=new Date(i.exitEta().getTime()+1e3*t.Utils.getNonHighwayDrivingTimeToPlaceInSeconds(i.poiOnJunction.dfe));return"you will be there by "+t.Utils.getTimeString(e)}),this.etaString=ko.computed(function(){var e=new Date(i.exitEta().getTime()+1e3*t.Utils.getNonHighwayDrivingTimeToPlaceInSeconds(i.poiOnJunction.dfe)),o=new Date(e.getTime()+60*i.stopDuration()*1e3);return t.Utils.getTimeString(e)+"-"+t.Utils.getTimeString(o)}),this.stopDurationHours=ko.computed(function(){var t=Math.floor(i.stopDurationFastUpdate()/60).toString();return 1===t.length&&(t="0"+t),t}),this.stopDurationMinutes=ko.computed(function(){var t=(i.stopDurationFastUpdate()%60).toString();return 1===t.length&&(t="0"+t),t}),this.detourDuration=ko.computed(function(){return 2*t.Utils.getNonHighwayDrivingTimeToPlaceInSeconds(i.poiOnJunction.dfe)+60*i.stopDuration()})}return e.prototype.add5MinutesToDuration=function(){t.Telemetry.trackEvent(t.TelemetryEvent.Add5MinToStop),this.stopDurationFastUpdate(this.stopDurationFastUpdate()+5),this.stopDuration(this.stopDurationFastUpdate())},e.prototype.subtract5MinutesFromDuration=function(){t.Telemetry.trackEvent(t.TelemetryEvent.Remove5MinFromStop),this.stopDurationFastUpdate(Math.max(0,this.stopDurationFastUpdate()-5)),this.stopDuration(this.stopDurationFastUpdate())},e.prototype.navigate=function(){t.Telemetry.trackEvent(t.TelemetryEvent.StopPopupNavigateClick,null,null,!0),t.Utils.getNavigationUrlFromCurrentLocation(this.poiOnJunction.poi.location).done(function(e){t.Telemetry.trackEvent(t.TelemetryEvent.StopPopupNavigateBeforeDirect,[{k:t.TelemetryProperty.NavigationUrl,v:e}],null,!0),t.Utils.windowOpen(e)})},e}();t.RouteStopViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i){if(this.poiLookup={},this._obj=e.j,this._app=i,this.dfrs=e.dfrs,this.name=this._obj.n,this.index=this._obj.i,this.osmid=this._obj.oid,this.highwayName=this._obj.hn,this.ref=this._obj.r,this.location=new t.LocationViewModel(this._obj.l),this.exitTo=this._obj.et,this.exitToLeft=this._obj.etl,this.exitToRight=this._obj.etr,this._obj.p){this.pois=ko.observableArray();for(var o=0;o<this._obj.p.length;o++){var n=new t.PoiOnJunctionViewModel(this._obj.p[o],this,this._app);this.pois.push(n),this.poiLookup[this._obj.p[o].p.id]=n}}this.pois.sort(function(t,e){return t.dfe-e.dfe})}return e.prototype.completeYDataLoad=function(){for(var t=0;t<this._obj.p.length;t++)this.poiLookup[this._obj.p[t].p.id].poi.updateYInfo(null)},e.normalizePhoneNumber=function(t){return t=t.replace(/[^0-9]/g,""),t=t.substr(t.length-10)},e}();t.JunctionViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i,o){var n=this;this._rpc=e,this.visiblePois=ko.observableArray([]),this.closestPoiDistance=ko.observable(""),this.poiCountString=ko.observable(""),this._junctionViewModel=i,this.poiTypeString=t.PoiType[e.t].toLowerCase(),this.url=t.Utils.getShareUrl(t.AppState.current.basePortalUrl,{page:t.SBSPage.exit,routeId:o.routeId,exitId:this._junctionViewModel.osmid.toString(),poiType:this._rpc.t}),this.poiCountStringWithLabel=ko.computed(function(){return n.poiCountString()+" "+n._rpc.n+"(s)"})}return e.prototype.update=function(){this.visiblePois.sort(function(t,e){return t.dfe-e.dfe}),this.closestPoiDistance(this.visiblePois().length>0?t.Utils.getMileString(this.visiblePois()[0].dfe):""),this.poiCountString(this.visiblePois().length>9?"9+":this.visiblePois().length.toString())},e.prototype.navigateToExitPage=function(){t.Utils.spaPageNavigate({page:t.SBSPage.exit,routeId:t.AppState.current.navigationLocation.routeId,exitId:this._junctionViewModel.osmid.toString(),poiType:this._rpc.t})},e}();t.RouteJunctionPoiTypeViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i,o){var n=this;if(this._obj=this.routeJunction=e,this.distanceFromRouteStartText=ko.observable(t.Utils.getMileString(this._obj.dfrs)),this.junction=new t.JunctionViewModel(this._obj,o),this.visible=ko.observable(!0),this.top=ko.observable(""),this.stops=ko.observableArray(),this.poiTypeViewModels=ko.observableArray(),this._poiTypeViewModelLookup={},this.etaWithoutStops=new Date(i.getTime()+1e3*this._obj.tfrs),this.eta=ko.observable(this.etaWithoutStops),this.hasStops=ko.computed(function(){return n.stops().length>0}),o.title&&o.title()){var r=o.title();r=r.substr(0,1).toLowerCase()+r.substr(1),this.title=this.junction.name+" on the way from "+r}var a=t.AppState.current.metadata.rpc;for(var s in a){var p=a[s],u=new t.RouteJunctionPoiTypeViewModel(p,this.junction,o);this.poiTypeViewModels.push(u),this._poiTypeViewModelLookup[p.t]=u}this.description=ko.computed(function(){var t=n.junction.name+". ";return $.each(n.poiTypeViewModels(),function(e,i){t+=" "+i.poiCountStringWithLabel()}),t+=" within 5 mile travel distance"}),this.etaString=ko.computed(function(){var e=t.Utils.getTimeString(n.eta());return n.hasStops()&&(e=t.Utils.getTimeString(n.eta())+"-"+t.Utils.getTimeString(n.etd())),e}),this.etd=ko.computed(function(){for(var t=0,e=0;e<n.stops().length;e++)t+=n.stops()[e].detourDuration();return new Date(n.eta().getTime()+1e3*t)}),this.url=t.Utils.getShareUrl(t.AppState.current.basePortalUrl,{page:t.SBSPage.exit,routeId:o.routeId,exitId:this.routeJunction.j.oid.toString()})}return e.prototype.onPoiVisibilityUpdated=function(){$.each(this.poiTypeViewModels(),function(t,e){e.visiblePois.removeAll()});for(var t=!1,e=!1,i=0;i<this.junction.pois().length;i++){var o=this.junction.pois()[i];void 0!==o.obj.v&&!0!==o.obj.v||(this._poiTypeViewModelLookup[o.poi.poiType].visiblePois.push(o),e=!0)}return $.each(this.poiTypeViewModels(),function(t,e){e.update()}),t=this.visible()!==e,this.visible(e),t},e.prototype.navigateToExitPage=function(){
t.Utils.spaPageNavigate({page:t.SBSPage.exit,routeId:t.AppState.current.navigationLocation.routeId,exitId:this.junction.osmid.toString()})},e}();t.RouteJunctionViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(t,e,i){this._stopDictionary={},this.junctionMap={},this.routeDistance=e,this._routeId=t,this.stops=ko.observableArray([]),this.editedStop=ko.observable(null),this._stopDictionary={},this._destination=i}return e.prototype.getOrCreateStop=function(e){var i=e.poi.id;if(!this._stopDictionary[i]){var o=new t.RouteStopViewModel(e);this._stopDictionary[i]=o}return this._stopDictionary[i]},e.prototype.addEditedStopToRoute=function(){this.addStopToRoute(this.editedStop()),t.Utils.spaPageNavigate({page:t.SBSPage.route,routeId:t.AppState.current.navigationLocation.routeId})},e.prototype.removeEditedStop=function(){this.removeStop(this.editedStop()),this.closeStopSettings()},e.prototype.navigateToEditedStop=function(){this.editedStop().navigate()},e.prototype.addStopToRoute=function(e,i){void 0===i&&(i=!1),t.Telemetry.trackEvent(t.TelemetryEvent.AddStopToRoute,[{k:t.TelemetryProperty.LoadStopsFromCache,v:i.toString()}]);var o=!1;if($.each(this.stops(),function(t,i){i.poiOnJunction.poi.id===e.poiOnJunction.poi.id&&(o=!0)}),!o){this.stops.push(this._stopDictionary[e.poiOnJunction.poi.id]);var n=this.junctionMap[e.poiOnJunction.exitId];n?n.stops.push(e):t.Telemetry.trackError(new Error("RouteStopViewModel.addStopToRoute.0"),null,null)}},e.prototype.removeStop=function(e){t.Telemetry.trackEvent(t.TelemetryEvent.RemoveStopFromRoute);var i=e.poiOnJunction.poi.id;if(this._stopDictionary[i]){var e=this._stopDictionary[i];this.stops.remove(e);var o=this.junctionMap[e.poiOnJunction.exitId];o&&o.stops.remove(e),delete this._stopDictionary[i]}},e.prototype.showStopSettings=function(e){t.Telemetry.trackEvent(t.TelemetryEvent.ShowStopSettingsPopup),this.editedStop(e);var i=$("."+t.AppState.current.pageInfo.pageName+" .stop-settings-dialog");i.on("popupafteropen",function(){var t=($(window).width()-i.width())/2,e=($(window).height()-i.height())/2;$(".ui-popup-container").css({top:e,left:t,position:"fixed"})}),i.popup({transition:"slidedown",corners:!0}),ko.tasks.runEarly(),i.trigger("create"),i.popup("open")},e.prototype.closeStopSettings=function(){$("."+t.AppState.current.pageInfo.pageName+" .stop-settings-dialog").popup("close")},e.prototype.navigate=function(){var e=this;t.Telemetry.trackEvent(t.TelemetryEvent.RoutePlanNavigateClick,null,null,!0);var i=this.stops().map(function(t){return t.poiOnJunction.poi.location});i.push(this._destination),t.Utils.getNavigationUrlFromCurrentLocation.apply(null,i).done(function(i){t.Telemetry.trackEvent(t.TelemetryEvent.RoutePlanNavigateBeforeDirect,[{k:t.TelemetryProperty.StopCount,v:e.stops().length.toString()},{k:t.TelemetryProperty.NavigationUrl,v:i}],null,!0),t.Utils.windowOpen(i)})},e}();t.RoutePlanViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(i,o,n){var r=this;if(this._obj=i,this._app=n,this.highwayNameText=ko.observable(""),this._obj.r?(this.highwayNameText(this._obj.r),this._obj.hn&&this._obj.hn!==this._obj.r&&this.highwayNameText(this._obj.r+" - "+this._obj.hn)):this._obj.hn?this.highwayNameText(this._obj.hn):this.highwayNameText(""),this.start=ko.observable(new t.LocationViewModel(this._obj.s)),this.end=ko.observable(new t.LocationViewModel(this._obj.e)),this.distance=ko.observable(this._obj.d),this.routeJunctions=[],this._obj.j)for(var a=0;a<this._obj.j.length;a++){var s=new t.RouteJunctionViewModel(this._obj.j[a],o,this._app);this._app.routePlan.junctionMap[s.junction.osmid.toString()]=s,this.routeJunctions.push(s)}this.routeVisibleJunctions=ko.observableArray([]),this.portionCompleted=ko.observable(this._obj.pc),this.startIndex=ko.observable(this._obj.si),this.endIndex=ko.observable(this._obj.ei),this.height=ko.computed(function(){return(r.routeVisibleJunctions().length*e.SPACE_FOR_JUNCTION+e.SEGMENT_INITIAL_SPACE).toString()+"em"}),this.distanceText=ko.computed(function(){return t.Utils.getMileString(r.distance())}),this.maneuver=this._obj.m,this.instructions=this._obj.i||"",this.instructionsTip=this.instructions.replace(/(<([^>]+)>)/gi,"")}return e.prototype.onJunctionVisibilityUpdated=function(){this.routeVisibleJunctions.removeAll();for(var t=0,i=0;i<this.routeJunctions.length;i++){var o=this.routeJunctions[i];o.visible()&&(this.routeVisibleJunctions.push(o),o.top((e.SEGMENT_INITIAL_SPACE+t*e.SPACE_FOR_JUNCTION).toString()+"em"),t++)}},e.SEGMENT_INITIAL_SPACE=7,e.SPACE_FOR_JUNCTION=8,e}();t.RouteSegmentViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i){this.stop=e,this.routePlan=i,this.poiTypeClass=t.PoiType[e.poiOnJunction.poi.poiType],this.top=ko.observable(""),this.left=ko.observable("")}return e.prototype.click=function(){this.routePlan.showStopSettings(this.stop)},e}();t.SideBarStopViewModel=e;var i=function(){function i(e,i,o){var n=this;this._headerHeight=0,this._footerHeight=0,this._thumbHeight=0,this._scrollProcessingScheduled=!1,this._thumbPageY=null,this._thumbTopAtDragStart=0,this._routeContentSelector=".route-page .ui-content",this._sideBarInit=t.Utils.runOnce(function(){$("#sidebar-thumb").unbind(),$(n._routeContentSelector).unbind(),$("#sidebar-thumb").bind("touchstart mousedown",function(t){n.onTouchStart(t)}),$("#sidebar-thumb").bind("touchend mouseup",function(t){n.onTouchEnd(t)}),$(n._routeContentSelector).bind("mousemove",function(t){n.onTouchMove(t,t.pageY)}),$(n._routeContentSelector).bind("touchmove",function(t){n.onTouchMove(t,t.originalEvent.touches[0].pageY)}),n._headerHeight=$("."+t.AppState.current.pageInfo.pageName+" .ui-header").outerHeight(),n._footerHeight=$("."+t.AppState.current.pageInfo.pageName+" .ui-footer").outerHeight(),n.sideBarHeight($(window).height()),n.sideBarInnerHeight($(window).height()),n.sideBarInnerTop($(".sidebar-top").outerHeight())}),this._sideBarFirstScrollInit=t.Utils.runOnce(this.sideBarFirstScrollInit.bind(this)),this.sideBarHeight=ko.observable(0),this.sideBarInnerHeight=ko.observable(0),this.sideBarInnerTop=ko.observable(0),this.sideBarPosition=ko.observable("absolute"),this.sideBarTop=ko.observable("40px"),this.sideBarBottom=ko.observable(""),this.sideBarThumbTop=ko.observable("0px"),this.isDraggingThumb=ko.observable(!1),this.stops=ko.observableArray([]),this._routePlanViewModel=e,this._routeViewModel=i,$(document).scroll(function(){n._scrollProcessingScheduled||(window.setTimeout(function(){n.onScroll(),n._scrollProcessingScheduled=!1},20),n._scrollProcessingScheduled=!0)})}return i.prototype.postInit=function(){this._sideBarInit()},i.prototype.recalculatePosition=function(){i.recalculateSideBarPosition(this)},i.prototype.onTouchStart=function(e){t.Telemetry.trackEvent(t.TelemetryEvent.SideBarThumbTouch),this.isDraggingThumb(!0),this._thumbTopAtDragStart=parseInt(this.sideBarThumbTop()),e.preventDefault()},i.prototype.onTouchEnd=function(t){if(this.isDraggingThumb()){this._thumbPageY=null,this.isDraggingThumb(!1);var e=parseInt(this.sideBarThumbTop()),i=e-this._thumbTopAtDragStart,o=$(".route").innerHeight()/(this.sideBarInnerHeight()-this._thumbHeight)*i;window.scrollBy(0,o),t.preventDefault()}},i.prototype.onTouchMove=function(t,e){if(this.isDraggingThumb()){if(this._thumbPageY){var i=parseInt(this.sideBarThumbTop()),o=i+(e-this._thumbPageY);o=Math.max(0,o),o=Math.min(this.sideBarInnerHeight()-this._thumbHeight,o),this.sideBarThumbTop(o.toString()+"px")}this._thumbPageY=e,t.preventDefault()}},i.prototype.onScroll=function(){this._sideBarFirstScrollInit();var t=$(document).scrollTop(),e=$(this._routeContentSelector).offset().top;t>e?(this.sideBarPosition("fixed"),this.sideBarTop(""),this.sideBarBottom((this._footerHeight+1).toString()+"px"),this._portionOfRouteScrolled=Math.min(1,(t-e)/($(".route").innerHeight()-$(window).height()-this._footerHeight)),this.recalcThumbPosition()):(this.sideBarPosition("absolute"),this.sideBarTop("40px"),this.sideBarBottom(""),this.sideBarThumbTop("0px")),ko.tasks.runEarly()},i.prototype.recalcThumbPosition=function(){this.sideBarThumbTop(((this.sideBarInnerHeight()-this._thumbHeight)*this._portionOfRouteScrolled).toString()+"px")},i.prototype.sideBarFirstScrollInit=function(){var e=this;t.Telemetry.trackEvent(t.TelemetryEvent.RoutePageScroll),i.recalculateSideBarPosition(this),i._recalcOnWindowResize&&$(window).off("resize",i._recalcOnWindowResize),i._recalcOnWindowResize=i.recalculateSideBarPosition.bind(null,this),$(window).on("resize",i._recalcOnWindowResize),this._routePlanViewModel.stops.subscribe(function(){return e.updateStopsOnSidebar()}),this._routeViewModel.roadLineHeight.subscribe(function(){return e.updateStopsOnSidebar()})},i.prototype.updateStopsOnSidebar=function(){var i=this;this.stops.removeAll();var o=$.map(this._routePlanViewModel.stops(),function(t,o){return new e(t,i._routePlanViewModel)});if(o.length>0&&t.Utils.hasAnyOwnProperties(this._routeViewModel.routeJunctionElementLookup)){o.sort(function(t,e){return t.stop.poiOnJunction.dtefrs-e.stop.poiOnJunction.dtefrs});for(var n="",r=0,a=0;a<o.length;a++){var s=o[a],p=s.stop.poiOnJunction.exitId;if(this._routeViewModel.routeJunctionElementLookup[p]){p===n?r++:(r=0,n=p);var u=this.sideBarInnerHeight()-32,c=u*this._routeViewModel.routeJunctionElementLookup[p].top*1.15/this._routeViewModel.roadLineHeight();s.top(c.toString()+"px"),s.left((8*r-28).toString()+"px"),this.stops.push(s)}}}},i.recalculateSideBarPosition=function(e){e._headerHeight=$("."+t.AppState.current.pageInfo.pageName+" .ui-header").outerHeight(),e._footerHeight=$("."+t.AppState.current.pageInfo.pageName+" .ui-footer").outerHeight(),e._thumbHeight=$("#sidebar-thumb").outerHeight();var i=$(".sidebar-top").outerHeight(),o=$(".sidebar-bottom").outerHeight(),n=window.innerHeight?window.innerHeight:$(window).height(),r=n-e._headerHeight-e._footerHeight,a=r-o-i;e.sideBarHeight(r),e.sideBarInnerHeight(a),e.sideBarInnerTop(i),e.recalcThumbPosition(),e.updateStopsOnSidebar()},i}();t.SideBarViewModel=i}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i,o,n){var r=this;this._stopDurationSubscriptions=[],this._junctionElementCount=0,this._subscribedForBoundElement=!1,this.routeJunctionElementLookup={},this.roadLineHeight=ko.observable(0),this.routeHeightPx=ko.observable(0),this.boundElement=ko.observable(null),this._route=this.route=e,this._app=i,this._routeInitializationComplete=n,this.sideBar=new t.SideBarViewModel(i.routePlan,this,o),this.fromLocation=new t.LocationViewModel(this._route.fl),this.toLocation=new t.LocationViewModel(this._route.tl),this.currentLocation=ko.observable(new t.LocationViewModel(this._route.cl)),this._routeStartTime=new Date,this.startTimeString=ko.observable(t.Utils.getTimeString(this._routeStartTime)),this.etaString=ko.observable(t.Utils.getTimeString(this._routeStartTime,1e3*this._route.t)),this.tripTimeHours=ko.observable(t.Utils.getHours(this._route.t)),this.tripTimeMinutes=ko.observable(t.Utils.getMinutes(this._route.t)),this.routeId=this._route.rid,this.distance=this._route.d,0===this.fromLocation.placeDescription.indexOf("Start location (")&&(this.fromLocation.placeDescription="Your location"),this.title=this.fromLocation.placeDescription+" to "+this.toLocation.placeDescription;var a=0;$.each(e.s,function(t,e){a+=e.j.length}),this.description="Traveling by car from "+this.fromLocation.placeDescription.toString()+" to "+this.toLocation.placeDescription.toString()+" and looking for best place to stop for food or gas? This route is "+this.distance.toString()+" miles and has "+a.toString()+" exits.Check this out. ",this.shortDescription="Distance "+this.distance.toString()+". "+a.toString()+" exits",this.routeSegments=ko.observableArray([]),this.createSegmentFirstTime(0),this.boundElement=ko.observable(null),this.boundElement.subscribe(function(e){e&&!r._subscribedForBoundElement&&(r._subscribedForBoundElement=!0,r.recalcRoadLine(e),t.Utils.observeDOM(e,function(){r.recalcRoadLine(e)}))})}return e.prototype.recalcRoadLine=function(t){var e=this,i=$(t).find(".junction-wrapper"),o=i.length,n="",r=$(this.boundElement()).height();0===r||o===this._junctionElementCount&&this.roadLineHeight()===r||(this.roadLineHeight(r),this._junctionElementCount=o,this.routeJunctionElementLookup={},i.each(function(i,o){n=$(t).offset().top.toString(),e.routeJunctionElementLookup[o.getAttribute("osmid")]={top:$(o).offset().top-$(t).offset().top}}))},e.prototype.createSegmentFirstTime=function(e){var i=this,o=new t.RouteSegmentViewModel(this._route.s[e],this._routeStartTime,this._app);this.routeSegments.push(o),e++,this._route.s.length>e?window.setTimeout(function(){return i.createSegmentFirstTime(e)},100):(this._routeInitializationComplete(),this.initializeEtaTimes())},e.prototype.initializeEtaTimes=function(){var t=this;this.updateEtaTimes(),this.updateStopDurationChangeSubscriptions(),this._app.routePlan.stops.subscribe(function(){t.updateEtaTimes(),t.updateStopDurationChangeSubscriptions()})},e.prototype.updateStopDurationChangeSubscriptions=function(){var t=this;$.each(this._stopDurationSubscriptions,function(t,e){e.dispose()}),$.each(this._app.routePlan.stops(),function(e,i){t._stopDurationSubscriptions.push(i.stopDuration.subscribe(function(){return t.updateEtaTimes()}))})},e.prototype.updateEtaTimes=function(){for(var e=(this._routeStartTime,0),i=0;i<this.routeSegments().length;i++)for(var o=0;o<this.routeSegments()[i].routeJunctions.length;o++){var n=this.routeSegments()[i].routeJunctions[o];n.eta(new Date(n.etaWithoutStops.getTime()+e));for(var r=0,a=0;a<n.stops().length;a++){var s=n.stops()[a];r+=1e3*s.detourDuration(),s.exitEta(n.eta())}e+=r}this.etaString(t.Utils.getTimeString(this._routeStartTime,1e3*this._route.t+e)),this.tripTimeHours=ko.observable(t.Utils.getHours(this._route.t+e/1e3)),this.tripTimeMinutes=ko.observable(t.Utils.getMinutes(this._route.t+e/1e3))},e}();t.RouteViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i,o,n){void 0===n&&(n=null);var r=this;if(this.route=null,this.url=ko.observable(""),this.title=ko.observable(""),this.filter={},this.routePlan=null,this.isRouteLoading=ko.observable(!1),this.routeLoadingMessage=ko.observable(""),this.selectedJunction=ko.observable(null),this.selectedPoi=ko.observable(null),this.isRouteLoading(!0),this.routeLoadingMessage("Loading route "+o+" ..."),this.url(t.Utils.getShareUrl(i.basePortalUrl,i.navigationLocation)),e){this._route=e;var a=[];$.each(e.s,function(t,e){a.push.apply(a,e.j)}),this.filter=new t.FilterViewModel(e.rid,a,t.AppState.current.metadata),this.filter.onFilterUpdated=this.onPoiFilterUpdated.bind(this),this.routePlan=new t.RoutePlanViewModel(this._route.rid,this._route.d,new t.LocationViewModel(e.tl)),this.isRouteLoading(!1),this.routeId=e.rid,this.route=new t.RouteViewModel(this._route,this,i,function(){$.each(r.route.routeSegments(),function(t,e){$.each(e.routeJunctions,function(t,e){e.onPoiVisibilityUpdated()}),e.onJunctionVisibilityUpdated()}),n&&n()}),this.title(this.route.title+" - Stop by Stop")}else this.title("See best places to stop on the way to your destination - Stop by Stop");window.document.title=this.title()}return e.prototype.initSideBar=function(){this.route&&this.route.sideBar&&this.route.sideBar.postInit()},e.prototype.onPoiFilterUpdated=function(){$.each(this.route.routeSegments(),function(t,e){var i=!1;$.each(e.routeJunctions,function(t,e){e.onPoiVisibilityUpdated()&&(i=!0)}),i&&e.onJunctionVisibilityUpdated()})},e}();t.AppViewModel=e}(StopByStop||(StopByStop={})),String.prototype.f=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this,o=t.length;o--;)i=i.replace(new RegExp("\\{"+o+"\\}","gm"),t[o]);return i};var StopByStop;!function(t){var e=function(){function e(t,e,i,o){this.mapDivInitialized=!1,this.junction=i,this.mapDiv=t,this.mapContainerDiv=e,this.urls=o}return e.prototype.initMapDiv=function(){this.mapDivInitialized||($(this.mapDiv).css({height:$(this.mapDiv).width()+"px"}),this.onMapReady(),this.mapDivInitialized=!0)},e.prototype.onMapReady=function(){var t=new google.maps.LatLng(this.junction.junction.location.lat,this.junction.junction.location.lon);this.map=new google.maps.Map(this.mapDiv,{zoom:14,center:t,disableDefaultUI:!1});new google.maps.Marker({position:t,map:this.map,icon:this.urls.BaseImageUrl+"icons/exit_map.png"});this.createPois()},e.prototype.createPois=function(){var e=this,i=this.junction.junction.pois();$.each(i,function(i,o){var n=o,r=new google.maps.LatLng(n.poi.location.lat,n.poi.location.lon);t.Utils;var a=new google.maps.Marker({position:r,icon:t.Utils.getPoiIconUrl(n.poi.poiType,t.PoiIconFormat.Map,e.urls.BaseImageUrl),map:e.map});a.setVisible(n.poi.visible()),a.addListener("click",function(){if(e.poiInfoWindow&&e.poiInfoWindow.close(),ko.cleanNode($("#poiPopupTemplate")[0]),ko.applyBindings(n,$("#poiPopupTemplate")[0]),!a.iw){var t=new google.maps.InfoWindow({content:$("#poiPopupTemplate").html()});a.iw=t,n.poi.isYInfoLoading.subscribe(function(){ko.cleanNode($("#poiPopupTemplate")[0]),ko.applyBindings(n,$("#poiPopupTemplate")[0]),t.setContent($("#poiPopupTemplate").html())})}e.poiInfoWindow=a.iw,window.navigateToPoiPage=function(){n.navigateToPoiPageClick()},e.poiInfoWindow.open(e.map,a)}),n.poi.visible.subscribe(function(t){a.setVisible(t),!t&&a.iw&&a.iw.close()})})},e}();t.JunctionMapViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(e,i,o,n,r,a){void 0===a&&(a=t.PoiType.all);var s=this;this._locationToLoadIndex=0,this.routeId=e.rid,this.routePlan=n,this.routeJunction=i,this.filter=new t.FilterViewModel(o.routeId,[this.routeJunction.routeJunction],r,!1),this.filter.maxDistanceFromJunction(o.maxDistanceFromJunction());for(var p=[[this.filter.maxDistanceFromJunctionIs1,"1"],[this.filter.maxDistanceFromJunctionIs2,"2"],[this.filter.maxDistanceFromJunctionIs3,"3"],[this.filter.maxDistanceFromJunctionIs4,"4"],[this.filter.maxDistanceFromJunctionIs5,"5"]],u=0;u<p.length;u++)p[u][0](p[u][1]===o.maxDistanceFromJunction());this.filter.copyEnablement(o);for(var c in this.filter.typeFiltersLookup)this.filter.typeFiltersLookup[c].isOn(a===t.PoiType.all||parseInt(c)===a);this.filter.onFilterUpdated=function(){return s.routeJunction.onPoiVisibilityUpdated()};var l=this.routeJunction.junction.location;this._poiLocations=t.LocationViewModel.getGridLocations({a:l.lat,o:l.lon}),this.loadFullPoiData()}return e.prototype.initMap=function(e,i){return this.junctionMapViewModel=new t.JunctionMapViewModel(e,i,this.routeJunction,t.AppState.current.urls),this.junctionMapViewModel},e.prototype.loadFullPoiData=function(){var e=this;if(this._locationToLoadIndex<this._poiLocations.length){var i=this._poiLocations[this._locationToLoadIndex++],o=i.lat.toFixed(1),n=i.lon.toFixed(1);$.ajax(t.AppState.current.urls.PoiDataUrlV2+o+","+n).done(function(t){for(var i=0;i<t.length;i++){var o=t[i];e.routeJunction.junction.poiLookup[o.id]&&e.routeJunction.junction.poiLookup[o.id].poi.updateYInfo(o)}e.loadFullPoiData()})}else this.routeJunction.junction.completeYDataLoad()},e}();t.ExitPageViewModel=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(){}return e.startup=function(i){ko.options.deferUpdates=!0,e.enableUAMatch(),e._wireUpOnce=t.Utils.runOnce(e.wireupAndBind),$(document).on("pageinit",".jqm-demos",function(t){e.wireupAndBindOnce()}),$(document).on("pageinit",".sbs-homePG",function(e){t.InitHome.wireup()}),$(document).on("pageinit",".route-page",function(t){}),$(document).on("pageinit",".exit-page",function(t){}),$(document).on("pageinit",".poigroup-page",function(e){var i=!1;$(document).scroll(function(){i||(i=!0,t.Telemetry.trackEvent(t.TelemetryEvent.POIGroupPageScroll))})}),t.AppState.current=i,t.AppState.current.urls=new t.InitUrls(i.baseDataUrl,i.baseImageUrl),e._app=ko.observable(new t.AppViewModel(null,t.AppState.current,"")),e.wireupHashChange()},e.wireupAndBindOnce=function(){e._wireUpOnce()},e.wireupAndBind=function(){e.wireupOnShow(),$(".jqm-navmenu-link").click(function(){return e.openNavigationMenu()}),jQuery(".breadCrumb").jBreadCrumb(),$(".social-btn").click(function(){t.Telemetry.trackEvent(t.TelemetryEvent.SocialButtonClick)}),$(".filters-trigger").click(function(){t.Telemetry.trackEvent(t.TelemetryEvent.FilterButtonClick),e.openFilterPopup()});var i=$("#sbsRoot")[0];ko.applyBindings(e._app,i)},e.wireupOnShow=function(){var i,o=!1;$.mobile.pageContainer.pagecontainer({beforeshow:function(e,n){o=!1,i=(new Date).getTime();var r=n.toPage.attr("id"),a="#"+r;t.AppState.current.navigationLocation||(t.AppState.current.navigationLocation={page:t.SBSPage.home}),t.Utils.updateNavigationLocation(location.hash,t.AppState.current.navigationLocation);var s=t.Utils.getHashFromNavigationLocation(t.AppState.current.navigationLocation);location.hash!==s&&(t.AppState.current.knownHashChangeInProgress=!0,location.replace(s)),t.AppState.current.pageInfo={pageName:n.toPage.data("page-name"),telemetryPageName:n.toPage.data("telemetry-page-name")};var r=n.toPage[0].id;t.SBSPage[t.AppState.current.navigationLocation.page]!==r&&(t.Utils.spaPageNavigate(t.AppState.current.navigationLocation,!1),o=!0),$(a).css({paddingTop:"51px",paddingBottom:"50px"}),$("."+t.AppState.current.pageInfo.pageName+" .filters-container").css({right:"10%"})},show:function(n,r){if(!o){var a=t.Utils.getShareUrl(t.AppState.current.basePortalUrl,t.AppState.current.navigationLocation);if(e._app().url(a),!t.AppState.current.historyDisabled&&t.Utils.isHistoryAPISupported()){var s=history.state;s.url=a+location.hash,history.replaceState(s,s.title,a+location.hash)}switch(t.AppState.current.navigationLocation.page){case t.SBSPage.route:case t.SBSPage.exit:case t.SBSPage.poi:e._currentRouteId!==t.AppState.current.navigationLocation.routeId?(e._currentRouteId=t.AppState.current.navigationLocation.routeId,e._app(new t.AppViewModel(null,t.AppState.current,t.Utils.getRouteTitleFromRouteId(t.AppState.current.navigationLocation.routeId))),e._loadRoutePromise=e.loadRoute(t.AppState.current.navigationLocation.routeId),e._loadRoutePromise.done(function(t){e.completePageInit()})):e.completePageInit()}t.Telemetry.trackPageView(t.AppState.current.pageInfo.telemetryPageName,"#"+t.AppState.current.pageInfo.pageName,(new Date).getTime()-i)}}})},e.completePageInit=function(){switch(t.AppState.current.navigationLocation.page){case t.SBSPage.route:e.completeRoutePageInit();break;case t.SBSPage.exit:e.completeExitPageInit();break;case t.SBSPage.poi:e.completePoiPageInit()}},e.wireupHashChange=function(){var e=!1,i=function(){e||(e=!0,window.setTimeout(function(){if(!t.AppState.current.knownHashChangeInProgress){var i=location.hash,o=t.AppState.current.navigationLocation.page;t.Utils.updateNavigationLocation(i,t.AppState.current.navigationLocation),o!==t.AppState.current.navigationLocation.page&&t.Utils.spaPageNavigate(t.AppState.current.navigationLocation,!1)}t.AppState.current.knownHashChangeInProgress=!1,e=!1},100))};$(window).hashchange(i),!t.AppState.current.historyDisabled&&t.Utils.isHistoryAPISupported()&&(window.onpopstate=i),i()},e.loadRoute=function(i){var o=$.Deferred();if(e._cachedRoutes[i])e.onRouteDataLoaded(i,e._cachedRoutes[i],o);else{var n=!t.AppState.current.metadata;$.ajax({url:t.AppState.current.urls.RouteDataUrlV2+i+"/metadata/"+n.toString().toLowerCase(),dataType:"json",method:"GET",success:function(r){e._cachedRoutes[i]=r,n&&(t.AppState.current.metadata=r.m),e.onRouteDataLoaded(i,r,o)}})}return o.promise()},e.onRouteDataLoaded=function(i,o,n){if(i===e._currentRouteId){var r=o,a=new t.AppViewModel(r,t.AppState.current,t.Utils.getRouteTitleFromRouteId(i),function(){n.resolve()});e._app(a)}else n.reject()},e.completePoiPageInit=function(){var i=t.AppState.current.navigationLocation.poiId,o=e._app().routePlan.junctionMap[t.AppState.current.navigationLocation.exitId],n=e._app();if(!n.selectedJunction()){var r=new t.ExitPageViewModel(n.route.route,o,n.filter,n.routePlan,t.AppState.current.metadata,t.PoiType.all);n.selectedJunction(r)}var a=o.junction.pois().filter(function(t,e,o){return t.poi.id===i})[0];n.selectedPoi(a.poi),n.url(t.Utils.getShareUrl(t.AppState.current.basePortalUrl,t.AppState.current.navigationLocation)),n.title(a.poi.name),document.title=n.title()},e.completeExitPageInit=function(){var i=e._app().routePlan.junctionMap[t.AppState.current.navigationLocation.exitId],o=t.AppState.current.navigationLocation.poiType,n=e._app(),r=new t.ExitPageViewModel(n.route.route,i,n.filter,n.routePlan,t.AppState.current.metadata,o);n.selectedJunction(r),e.initJunctionMapWhenReady(r).then(function(t){$(".view-mode-switch").controlgroup(),$(".view-mode-switch").trigger("create"),e.wireupPOIGroup(t)}),n.url(t.Utils.getShareUrl(t.AppState.current.basePortalUrl,t.AppState.current.navigationLocation)),n.title(r.routeJunction.title),document.title=n.title(),e.animateFiltersTrigger()},e.completeRoutePageInit=function(){this._app().route.recalcRoadLine($(".route")[0]),this._app().title(this._app().route.shortDescription),this._app().route.sideBar.recalculatePosition(),e.animateFiltersTrigger()},e.animateFiltersTrigger=function(){window.setTimeout(function(){var e=$("."+t.AppState.current.pageInfo.pageName+" .filters-container");e.css({right:"10%"}),e.animate({right:"35%"},"slow")},50)},e.initJunctionMapWhenReady=function(t){var i=jQuery.Deferred(),o=$("#map")[0],n=$(".poi-map")[0];if(o&&n){var r=t.initMap(o,n);i.resolve(r)}else window.setTimeout(function(){e.initJunctionMapWhenReady(t).then(function(t){return i.resolve(t)})},50);return i.promise()},e.wireupPOIGroup=function(i){$(".view-mode-switch").on("change",function(){"list"===$(".view-mode-switch :radio:checked").val()?($(".poi-table").show(),$(".poi-map").hide(),t.Telemetry.trackEvent(t.TelemetryEvent.POIGroupSwitchList)):($(".poi-table").hide(),$(".poi-map").show(),i.initMapDiv(),t.Telemetry.trackEvent(t.TelemetryEvent.POIGroupSwitchMap))}),$(".yelp-btn").on("click",function(){t.Telemetry.trackEvent(t.TelemetryEvent.YelpLinkClick,null,null,!0)}),$(".tel-btn").on("click",function(){t.Telemetry.trackEvent(t.TelemetryEvent.TelLinkClick)}),$(".pois-list-filters-button").click(function(){t.Telemetry.trackEvent(t.TelemetryEvent.FilterButtonInlineExitPageClick),e.openFilterPopup()})},e.enableUAMatch=function(){var t,e;jQuery.uaMatch=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},t=jQuery.uaMatch(navigator.userAgent),e={},t.browser&&(e[t.browser]=!0,e.version=t.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0),jQuery.browser=e},e.openNavigationMenu=function(){var e=$("."+t.AppState.current.pageInfo.pageName+" .nav-menu");e.length>0&&(e.panel(),e.trigger("create"),e.panel("open"))},e.openFilterPopup=function(){var e=$("."+t.AppState.current.pageInfo.pageName+" .filter-dlg");e.on("popupafteropen",function(){var t=($(window).width()-e.width())/2,i=($(window).height()-e.height())/2;$(".ui-popup-container").css({top:i,left:t,position:"fixed"})}),e.length>0&&(e.popup(),e.trigger("create"),e.popup("open",{positionTo:"origin",transition:"slidedown"}))},e._loadRoutePromise=null,e._cachedRoutes={},e}();t.Init=e}(StopByStop||(StopByStop={}));var StopByStop;!function(t){var e=function(){function e(){}return e.startup=function(e){e.r&&(t.Init._cachedRoutes[e.rid]=e.r),e.exd&&0===e.exd.indexOf("osm-")&&(e.exd=e.exd.substr("osm-".length));var i={baseDataUrl:e.durl,baseImageUrl:e.iurl,basePortalUrl:e.purl,navigationLocation:{page:e.p,exitId:e.exd,poiType:e.pt,routeId:e.rid},historyDisabled:!0,windowOpenTarget:"_blank",metadata:e.m};if(t.Init.startup(i),!location.hash){var o=t.Utils.getHashFromNavigationLocation(i.navigationLocation);location.hash=o}},e}();t.WebInit=e}(StopByStop||(StopByStop={}));